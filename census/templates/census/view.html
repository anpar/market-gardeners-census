{% extends "census/base.html" %}

{% block content %}

{% if farm %}

	<div class="container mt-4">
		<a href="{% url 'census:listing' %}" class="btn btn-sm btn-secondary mb-4" >← Retour à la liste</a>
		<a href="{% url 'census:map' %}" class="btn btn-sm btn-secondary mb-4" >← Retour à la carte</a>

		<h2>
			{{ farm.name }}, à {{ farm.municipality.name }}

			{% if farm.fb_page %}
				<a href="{{ farm.fb_page }}" target="_blank" class="link-underline link-underline-opacity-0">
					<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-facebook" viewBox="0 0 16 16">
			      <path d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951"/>
					</svg>
				</a>
			{% endif %}

			{% if farm.website %}
				<a href="{{ farm.website }}" target="_blank" class="link-underline link-underline-opacity-0">
					<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-link-45deg" viewBox="0 0 16 16">
	          <path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1 1 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4 4 0 0 1-.128-1.287z"/>
	          <path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243z"/>
					</svg>
				</a>
			{% endif %}
		</h2>

		<hr class="my-4">

		<!-- Affichage des instructions pour réellement modifier les informations de cette ferme -->
		<!-- Affichage des messages -->
		{% if messages %}
				{% for m in messages %}
					{% if m.tags == 'success' %}
						<p class="alert alert-success" role="alert">
							{{ m }}
						</p>
					{% endif %}
					{% if m.tags == 'error' %}
						<p class="alert alert-danger" role="alert">
							{{ m }}
							Vous pensez que c'est une erreur ? <a href="/#contact">Contactez-nous</a>.
						</p>
					{% endif %}
				{% endfor %}
		{% endif %}

		<div class="alert alert-info" role="alert">
			<p class="lead">
				Vous êtes (co-)responsable de cette ferme ?
			</p>
			<p>
				Pour modifier les informations publiques liées à votre ferme
				(nom, commune, site web et page Facebook) et les informations privées utiles au recensement (surface cultivée,
				année d'installation, mode de production, etc.), indiquez ci-dessous l'adresse e-mail de votre ferme/projet de
				maraîchage. Vous recevrez un lien unique valable 24 heures permettant d'éditer votre ferme. Merci d'avance pour
				votre contribution au recensement !
			</p>

			<!-- Si un ou plusieurs mails pour cette ferme se trouve dans la base de données, afficher le formulaire -->
			{% if censored_emails %}

				{{ form.non_field_errors }}

				<form action="" method="post" class="row g-3">
					{% csrf_token %}

					<div class="col-md-4">
						{{ form.email }}
					</div>

					<div class="col-md-4">
						<button type="submit" class="btn btn-primary">Recevoir le lien</button>
					</div>

				<div class="form-text">
					L'adresse indiquée doit correspondre à {{ censored_emails|length|pluralize:"celle présente, l'une de celles présentes" }}
					dans notre base de données pour votre ferme ({% for email in censored_emails %}{{ email }}{% if not forloop.last %}, {% endif %}{% endfor%}).
					Ce {{ censored_emails|length|pluralize:"n'est pas la bonne adresse, ne sont pas les bonnes adresses" }} ?
					<a href="/#contact">Contactez-nous</a> pour régler cela.
				</div>
			</form>

			<!-- Si la base de données ne contient pas d'adresses e-mail pour ce projet -->
			{% else %}
				<div class="alert alert-danger" role="alert">
					Notre base de données ne contient pas d'adresse e-mail pour votre ferme.
					<a href="/#contact">Contactez-nous</a> pour régler cela.
				</div>
			{% endif %}

		</div>
	</div>

{% else %}
  <p>La ferme demandée n'existe pas.</p>
{% endif %}

{% endblock content %}